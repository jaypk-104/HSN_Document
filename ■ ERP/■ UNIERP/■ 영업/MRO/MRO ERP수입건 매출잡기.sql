/*
1
*/

--출고번호 : DN2020092300001
--매출번호 : BM2020093000062 

SELECT * 
FROM CBO_MRO_ORD_BILL_DTL
WHERE BILL_NO = 'BM2020093000062'

SELECT * 
FROM S_BILL_DTL
WHERE BILL_NO = 'BM2020093000062'

SELECT A.BILL_NO, A.BILL_SEQ, A.ITEM_CD, A.DN_NO, A.DN_SEQ, B.DN_NO, B.DN_SEQ,  A.SO_NO, B.SO_NO, A.SO_SEQ ,B.SO_SEQ, A.BILL_QTY, B.BILL_QTY
FROM S_BILL_DTL A JOIN S_DN_DTL B ON A.ITEM_CD = B.ITEM_CD AND A.BILL_QTY = B.GI_QTY
WHERE A.BILL_NO = 'BM2020093000062'
AND B.DN_NO IN (
'DN2020092300001'
)


/*
2 출고,수주번호 바꿔치기
MRO팀이 ERP에서 입고 잡고 나서 입고기준 출고등록에서 출고등록을 한다.
MRO에서 넘어온 매출에 ERP에서 등록한 출고데이터 매핑 시켜줘야함
*/


BEGIN TRAN
UPDATE A
SET A.DN_NO = B.DN_NO ,
A.DN_SEQ= B.DN_SEQ,
A.SO_NO = B.SO_NO,
A.SO_SEQ = B.SO_SEQ
FROM S_BILL_DTL A JOIN S_DN_DTL B ON A.ITEM_CD = B.ITEM_CD AND A.BILL_QTY = B.GI_QTY
WHERE A.BILL_NO = 'BM2020073100017'
AND B.DN_NO IN (
'DN2020073100001'
)


COMMIT

/*
3 출고 BILL_QTY 업데이트
*/
BEGIN TRAN
UPDATE B
SET B.BILL_QTY = A.BILL_QTY
FROM S_BILL_DTL A JOIN S_DN_DTL B ON A.ITEM_CD = B.ITEM_CD AND A.BILL_QTY = B.GI_QTY
WHERE A.BILL_NO = 'BM2020073100017'
AND B.DN_NO IN (
'DN2020073100001'
)

/*
4 CBO_MRO_ORD_DTL 삭제
*/

BEGIN TRAN
DELETE FROM CBO_MRO_ORD_DTL
WHERE BILL_NO = 'BM2020073100017'
AND ITEM_CD IN (
'A2312N11445'
)
COMMIT